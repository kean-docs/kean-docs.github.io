{"primaryContentSections":[{"kind":"content","content":[{"anchor":"Access-Tokens","level":2,"type":"heading","text":"Access Tokens"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Every authorization system has its quirks. If you use "},{"type":"reference","isActive":true,"identifier":"https:\/\/oauth.net\/2\/"},{"type":"text","text":" or a similar protocol, you need to send an access token with every request. One of the common ways is by setting an "},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/HTTP\/Headers\/Authorization"},{"type":"text","text":" header. "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Get\/documentation\/Get\/APIClient"},{"type":"text","text":" provides all the necessary hooks to add any authorization mechanism that you need."}]},{"anchor":"Settings-Authorization-Headers","level":3,"type":"heading","text":"Settings Authorization Headers"},{"type":"paragraph","inlineContent":[{"type":"text","text":"While you can provide authorization headers in individual requests, a common approach is to set them in a centralized place. The "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Get\/documentation\/Get\/APIClientDelegate\/client(_:willSendRequest:)-8orzl"},{"type":"text","text":" delegate method is a good place to do it."}]},{"type":"codeListing","syntax":"swift","code":["final class ClientDelegate: APIClientDelegate {","    private var accessToken: String = \"\"","","    func client(_ client: APIClient, willSendRequest request: inout URLRequest) async throws {","        request.setValue(\"Bearer: \\(accessToken)\", forHTTPHeaderField: \"Authorization\")","    }","}"]},{"style":"important","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"If you look at native "},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/urlrequest\/2011447-setvalue"},{"type":"text","text":" documentation, you’ll see a list of "},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/nsurlrequest#1776617"},{"type":"text","text":" that you shouldn’t set manually. "},{"type":"codeVoice","code":"\"Authorization\""},{"type":"text","text":" is one of them and relies on "},{"type":"codeVoice","code":"URLSession"},{"type":"text","text":" built-in authorization mechanism. Unfortunately, it doesn’t support OAuth 2.0. Setting an "},{"type":"codeVoice","code":"\"Authorization\""},{"type":"text","text":" header manually is still "},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/forums\/thread\/89811"},{"type":"text","text":" option."}]}],"type":"aside","name":"Important"},{"style":"tip","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Get\/documentation\/Get\/APIClientDelegate\/client(_:willSendRequest:)-8orzl"},{"type":"text","text":" method is also a good way to provide default headers, like "},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/HTTP\/Headers\/User-Agent"},{"type":"text","text":". But you can also provide fields that don’t change using "},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/urlsessionconfiguration\/1411532-httpadditionalheaders"},{"type":"text","text":" property of "},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/urlsessionconfiguration"},{"type":"text","text":"."}]}],"type":"aside","name":"Tip"},{"anchor":"Refreshing-Tokens","level":3,"type":"heading","text":"Refreshing Tokens"},{"type":"paragraph","inlineContent":[{"type":"text","text":"If your access tokens are short-lived, it is important to implement a proper refresh flow. "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Get\/documentation\/Get\/APIClientDelegate"},{"type":"text","text":" provides a method for that too: ``APIClientDelegate\/clshoul`."}]},{"type":"codeListing","syntax":"swift","code":["final class ClientDelegate: APIClientDelegate {","    func client(_ client: APIClient, shouldRetry task: URLSessionTask, error: Error, attempts: Int) async throws -> Bool {","        if case .unacceptableStatusCode(let statusCode) = error as? APIError,","           statusCode == 401, attempts == 1 {","            accessToken = try await refreshAccessToken()","            return true","        }","        return false","    }","","    private func refreshAccessToken() async throws -> String {","        fatalError(\"Not implemented\")","    }","}"]},{"style":"important","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The client might call "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Get\/documentation\/Get\/APIClientDelegate\/client(_:shouldRetry:error:attempts:)-6tv21"},{"type":"text","text":"  multiple times (once for each failed request). Make sure to coalesce the requests to refresh the token and handle the scenario with an expired refresh token."}]}],"type":"aside","name":"Important"},{"style":"tip","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"If you are thinking about using auto-retries for connectivity issues, consider using "},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/urlsessionconfiguration\/2908812-waitsforconnectivity"},{"type":"text","text":" instead. If the request does fail with a network issue, it is usually best to communicate an error to the user. With "},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/network\/nwpathmonitor"},{"type":"text","text":" you can still monitor the connection to your server and retry automatically."}]}],"type":"aside","name":"Tip"},{"anchor":"Server-Trust","level":2,"type":"heading","text":"Server Trust"},{"type":"paragraph","inlineContent":[{"type":"text","text":"On top of authorizing the user, many services will also have a way of authorizing the client - your app. If it is an API key, you can set it using the same way as an "},{"type":"codeVoice","code":"\"Authorization\""},{"type":"text","text":" header."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"To learn more about Server Trust, see "},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/url_loading_system\/handling_an_authentication_challenge\/performing_manual_server_trust_authentication"},{"type":"text","text":"."}]}]}],"schemaVersion":{"major":0,"minor":3,"patch":0},"sections":[],"variants":[{"paths":["\/documentation\/get\/authentication"],"traits":[{"interfaceLanguage":"swift"}]}],"identifier":{"url":"doc:\/\/Get\/documentation\/Get\/authentication","interfaceLanguage":"swift"},"abstract":[{"type":"text","text":"Learn how to implement authentication."}],"kind":"article","metadata":{"roleHeading":"Article","title":"Authentication","role":"article","modules":[{"name":"Get"}]},"hierarchy":{"paths":[["doc:\/\/Get\/documentation\/Get"]]},"seeAlsoSections":[{"title":"Articles","identifiers":["doc:\/\/Get\/documentation\/Get\/define-api","doc:\/\/Get\/documentation\/Get\/caching","doc:\/\/Get\/documentation\/Get\/integrations"],"generated":true}],"references":{"https://developer.apple.com/forums/thread/89811":{"title":"the least worst","titleInlineContent":[{"type":"text","text":"the least worst"}],"type":"link","identifier":"https:\/\/developer.apple.com\/forums\/thread\/89811","url":"https:\/\/developer.apple.com\/forums\/thread\/89811"},"doc://Get/documentation/Get":{"role":"collection","title":"Get","abstract":[{"type":"text","text":"A lean Swift web API client built using async\/await."}],"identifier":"doc:\/\/Get\/documentation\/Get","kind":"symbol","type":"topic","url":"\/documentation\/get"},"https://developer.apple.com/documentation/foundation/nsurlrequest#1776617":{"title":"Reserved HTTP Headers","titleInlineContent":[{"type":"text","text":"Reserved HTTP Headers"}],"type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/nsurlrequest#1776617","url":"https:\/\/developer.apple.com\/documentation\/foundation\/nsurlrequest#1776617"},"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Authorization":{"title":"\"Authorization\"","titleInlineContent":[{"type":"codeVoice","code":"\"Authorization\""}],"type":"link","identifier":"https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/HTTP\/Headers\/Authorization","url":"https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/HTTP\/Headers\/Authorization"},"doc://Get/documentation/Get/Request":{"role":"symbol","title":"Request","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"Request"}],"abstract":[{"type":"text","text":"An HTTP network request."}],"identifier":"doc:\/\/Get\/documentation\/Get\/Request","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"Request"}],"url":"\/documentation\/get\/request"},"https://oauth.net/2/":{"title":"OAuth 2.0","titleInlineContent":[{"type":"text","text":"OAuth 2.0"}],"type":"link","identifier":"https:\/\/oauth.net\/2\/","url":"https:\/\/oauth.net\/2\/"},"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/User-Agent":{"title":"“User-Agent”","titleInlineContent":[{"type":"text","text":"“User-Agent”"}],"type":"link","identifier":"https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/HTTP\/Headers\/User-Agent","url":"https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/HTTP\/Headers\/User-Agent"},"https://developer.apple.com/documentation/foundation/urlsessionconfiguration/1411532-httpadditionalheaders":{"title":"httpAdditionalHeaders","titleInlineContent":[{"type":"codeVoice","code":"httpAdditionalHeaders"}],"type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/urlsessionconfiguration\/1411532-httpadditionalheaders","url":"https:\/\/developer.apple.com\/documentation\/foundation\/urlsessionconfiguration\/1411532-httpadditionalheaders"},"https://developer.apple.com/documentation/network/nwpathmonitor":{"title":"NWPathMonitor","titleInlineContent":[{"type":"codeVoice","code":"NWPathMonitor"}],"type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/network\/nwpathmonitor","url":"https:\/\/developer.apple.com\/documentation\/network\/nwpathmonitor"},"doc://Get/documentation/Get/APIClientDelegate/client(_:shouldRetry:error:attempts:)-6tv21":{"defaultImplementations":1,"role":"symbol","title":"client(_:shouldRetry:error:attempts:)","fragments":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"kind":"identifier","text":"client"},{"kind":"text","text":"("},{"kind":"typeIdentifier","text":"APIClient","preciseIdentifier":"s:3Get9APIClientC"},{"kind":"text","text":", "},{"kind":"externalParam","text":"shouldRetry"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"URLSessionTask","preciseIdentifier":"c:objc(cs)NSURLSessionTask"},{"kind":"text","text":", "},{"kind":"externalParam","text":"error"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"Error","preciseIdentifier":"s:s5ErrorP"},{"kind":"text","text":", "},{"kind":"externalParam","text":"attempts"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"Int","preciseIdentifier":"s:Si"},{"kind":"text","text":") "},{"kind":"keyword","text":"async"},{"kind":"text","text":" "},{"kind":"keyword","text":"throws"},{"kind":"text","text":" -> "},{"kind":"typeIdentifier","text":"Bool","preciseIdentifier":"s:Sb"}],"abstract":[{"type":"text","text":"Gets called after a networking failure. Only one retry attempt is allowed."}],"identifier":"doc:\/\/Get\/documentation\/Get\/APIClientDelegate\/client(_:shouldRetry:error:attempts:)-6tv21","kind":"symbol","required":true,"type":"topic","url":"\/documentation\/get\/apiclientdelegate\/client(_:shouldretry:error:attempts:)-6tv21"},"doc://Get/documentation/Get/APIClient":{"role":"symbol","title":"APIClient","fragments":[{"kind":"keyword","text":"class"},{"kind":"text","text":" "},{"kind":"identifier","text":"APIClient"}],"abstract":[{"type":"text","text":"Performs network requests constructed using "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Get\/documentation\/Get\/Request"},{"type":"text","text":"."}],"identifier":"doc:\/\/Get\/documentation\/Get\/APIClient","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"APIClient"}],"url":"\/documentation\/get\/apiclient"},"doc://Get/documentation/Get/APIClientDelegate/client(_:willSendRequest:)-8orzl":{"role":"symbol","title":"client(_:willSendRequest:)","fragments":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"kind":"identifier","text":"client"},{"kind":"text","text":"("},{"kind":"typeIdentifier","text":"APIClient","preciseIdentifier":"s:3Get9APIClientC"},{"kind":"text","text":", "},{"kind":"externalParam","text":"willSendRequest"},{"kind":"text","text":": "},{"kind":"keyword","text":"inout"},{"kind":"text","text":" "},{"kind":"typeIdentifier","text":"URLRequest","preciseIdentifier":"s:10Foundation10URLRequestV"},{"kind":"text","text":") "},{"kind":"keyword","text":"async"},{"kind":"text","text":" "},{"kind":"keyword","text":"throws"}],"abstract":[{"type":"text","text":"Allows you to modify the request right before it is sent."}],"identifier":"doc:\/\/Get\/documentation\/Get\/APIClientDelegate\/client(_:willSendRequest:)-8orzl","kind":"symbol","type":"topic","url":"\/documentation\/get\/apiclientdelegate\/client(_:willsendrequest:)-8orzl"},"https://developer.apple.com/documentation/foundation/url_loading_system/handling_an_authentication_challenge/performing_manual_server_trust_authentication":{"title":"Performing Manual Server Trust Authentication","titleInlineContent":[{"type":"text","text":"Performing Manual Server Trust Authentication"}],"type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/url_loading_system\/handling_an_authentication_challenge\/performing_manual_server_trust_authentication","url":"https:\/\/developer.apple.com\/documentation\/foundation\/url_loading_system\/handling_an_authentication_challenge\/performing_manual_server_trust_authentication"},"doc://Get/documentation/Get/APIClientDelegate":{"role":"symbol","title":"APIClientDelegate","fragments":[{"kind":"keyword","text":"protocol"},{"kind":"text","text":" "},{"kind":"identifier","text":"APIClientDelegate"}],"abstract":[{"type":"text","text":"Allows you to modify "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Get\/documentation\/Get\/APIClient"},{"type":"text","text":" behavior."}],"identifier":"doc:\/\/Get\/documentation\/Get\/APIClientDelegate","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"APIClientDelegate"}],"url":"\/documentation\/get\/apiclientdelegate"},"doc://Get/documentation/Get/define-api":{"role":"article","title":"Modeling APIs","abstract":[{"type":"text","text":"Learn how to define an API using "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Get\/documentation\/Get\/Request"},{"type":"text","text":" type."}],"identifier":"doc:\/\/Get\/documentation\/Get\/define-api","kind":"article","type":"topic","url":"\/documentation\/get\/define-api"},"doc://Get/documentation/Get/caching":{"role":"article","title":"Caching","abstract":[{"type":"text","text":"Learn how the framework caches data."}],"identifier":"doc:\/\/Get\/documentation\/Get\/caching","kind":"article","type":"topic","url":"\/documentation\/get\/caching"},"doc://Get/documentation/Get/integrations":{"role":"article","title":"Integrations","abstract":[{"type":"text","text":"Learn how to extend "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Get\/documentation\/Get\/APIClient"},{"type":"text","text":" using third-party frameworks."}],"identifier":"doc:\/\/Get\/documentation\/Get\/integrations","kind":"article","type":"topic","url":"\/documentation\/get\/integrations"},"https://developer.apple.com/documentation/foundation/urlrequest/2011447-setvalue":{"title":"setValue(_:forHTTPHeaderField:)","titleInlineContent":[{"type":"codeVoice","code":"setValue(_:forHTTPHeaderField:)"}],"type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/urlrequest\/2011447-setvalue","url":"https:\/\/developer.apple.com\/documentation\/foundation\/urlrequest\/2011447-setvalue"},"https://developer.apple.com/documentation/foundation/urlsessionconfiguration":{"title":"URLSessionConfiguration","titleInlineContent":[{"type":"codeVoice","code":"URLSessionConfiguration"}],"type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/urlsessionconfiguration","url":"https:\/\/developer.apple.com\/documentation\/foundation\/urlsessionconfiguration"},"https://developer.apple.com/documentation/foundation/urlsessionconfiguration/2908812-waitsforconnectivity":{"title":"waitsForConnectivity","titleInlineContent":[{"type":"codeVoice","code":"waitsForConnectivity"}],"type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/urlsessionconfiguration\/2908812-waitsforconnectivity","url":"https:\/\/developer.apple.com\/documentation\/foundation\/urlsessionconfiguration\/2908812-waitsforconnectivity"}}}