{"primaryContentSections":[{"kind":"content","content":[{"anchor":"Decompression","level":2,"type":"heading","text":"Decompression"},{"type":"paragraph","inlineContent":[{"type":"text","text":"When you instantiate "},{"type":"codeVoice","code":"UIImage"},{"type":"text","text":" with "},{"type":"codeVoice","code":"Data"},{"type":"text","text":", the data can be in a compressed format like "},{"type":"codeVoice","code":"JPEG"},{"type":"text","text":". "},{"type":"codeVoice","code":"UIImage"},{"type":"text","text":" does "},{"type":"emphasis","inlineContent":[{"type":"text","text":"not"}]},{"type":"text","text":" eagerly decompress this data until you display it. It leads to performance issues like scroll view stuttering. To avoid it, Nuke automatically decompresses the data in the background. Decompression only runs if needed; it won’t run for already processed images."}]},{"type":"aside","style":"tip","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"See "},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/videos\/play\/wwdc2018\/219"},{"type":"text","text":" to learn more about image decoding and downsampling."}]}]},{"anchor":"High-Resolution-Images","level":2,"type":"heading","text":"High-Resolution Images"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Bitmapped images take a lot of space in memory. For example, take a 6000x4000px image from a professional camera. Every pixel usually requires 4 bytes (RGBA). A JPEG of such an image might use anywhere from 3 to 30 MB. But if the uncompressed bitmap takes 92 MB."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"By default, Nuke stores decompressed (bitmapped) images in the memory cache. But this strategy might not be optimal for high-resolution images like this. Consider either downsampling such images or disabling memory cache for them to avoid taking too much memory."}]},{"anchor":"Downsample-Images","level":2,"type":"heading","text":"Downsample Images"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Ideally, the app should download the images optimized for the target device screen size; but it’s not always feasible. To reduce the memory usage, downsample the images."}]},{"type":"codeListing","syntax":"swift","code":["\/\/ Target size is in points.","let request = ImageRequest(","    url: URL(string: \"http:\/\/...\"),","    processors: [.resize(width: 320)]",")"]},{"type":"aside","style":"note","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Tips: See "},{"overridingTitleInlineContent":[{"type":"text","text":"Image and Graphics Best Practices"}],"isActive":true,"type":"reference","identifier":"https:\/\/developer.apple.com\/videos\/play\/wwdc2018\/219","overridingTitle":"Image and Graphics Best Practices"},{"type":"text","text":" to learn more about image decoding and downsampling."}]}]},{"anchor":"Aggressive-Cache","level":2,"type":"heading","text":"Aggressive Cache"},{"type":"paragraph","inlineContent":[{"type":"text","text":"By default, Nuke uses the native HTTP cache, but it’s relatively slow and is subject to the same maximum concurrent operations count as network tasks (because it’s part of the URL loading system). If your app doesn’t take advantage of complex HTTP cache-control parameters, consider enabling the custom aggressive disk cache. Learn more in "},{"type":"reference","isActive":true,"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/caching"},{"type":"text","text":"."}]},{"anchor":"Store-Processed-Images","level":2,"type":"heading","text":"Store Processed Images"},{"type":"paragraph","inlineContent":[{"type":"text","text":"By default, the aggressive disk cache (if enabled) stores original image data. If your app applies expensive processors or downsamples images, consider storing processed images instead by setting "},{"type":"reference","isActive":true,"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePipeline\/Configuration-swift.struct\/dataCachePolicy-swift.property"},{"type":"text","text":" to "},{"type":"reference","isActive":true,"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePipeline\/DataCachePolicy\/automatic"},{"type":"text","text":" or "},{"type":"reference","isActive":true,"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePipeline\/DataCachePolicy\/storeEncodedImages"},{"type":"text","text":" depending on the use case."}]},{"anchor":"Use-HEIF","level":2,"type":"heading","text":"Use HEIF"},{"type":"paragraph","inlineContent":[{"type":"text","text":"To save disk space see "},{"type":"reference","isActive":true,"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImageEncoders\/ImageIO"},{"type":"text","text":" and "},{"type":"reference","isActive":true,"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImageEncoders\/Default\/isHEIFPreferred"},{"type":"text","text":" option for HEIF support. By default, disabled."}]},{"anchor":"Prefetch-Images","level":2,"type":"heading","text":"Prefetch Images"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Loading data ahead of time in anticipation of its use ("},{"type":"reference","isActive":true,"identifier":"https:\/\/en.wikipedia.org\/wiki\/Prefetching"},{"type":"text","text":") is a great way to improve user experience. It’s especially effective for images; it can give users an impression that there is no networking and the images are just magically always there. For more info, see "},{"type":"reference","isActive":true,"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/prefetching"},{"type":"text","text":"."}]},{"anchor":"Resumable-Downloads","level":2,"type":"heading","text":"Resumable Downloads"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Make sure your server supports resumable downloads."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"If the data task is terminated when the image is partially loaded (either because of a failure or a cancellation), the next load will resume where the previous left off. Resumable downloads require the server to support "},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/HTTP\/Range_requests"},{"type":"text","text":". Nuke supports both validators: "},{"type":"codeVoice","code":"ETag"},{"type":"text","text":" and "},{"type":"codeVoice","code":"Last-Modified"},{"type":"text","text":". Resumable downloads are enabled by default. You can learn more in "},{"type":"reference","isActive":true,"identifier":"https:\/\/kean.blog\/post\/resumable-downloads"},{"type":"text","text":"."}]},{"anchor":"Request-Priorities","level":2,"type":"heading","text":"Request Priorities"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Nuke allows you to set the request priority and update it for outstanding tasks. It uses priorities for prefetching: the requests created by the prefetcher all have "},{"type":"codeVoice","code":".low"},{"type":"text","text":" priority to make sure they don’t interfere with the “regular” requests. See "},{"type":"reference","isActive":true,"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/prefetching"},{"type":"text","text":" to learn more."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"There are many other creative ways to use priorities. For example, when the user taps an image in a grid to open it full screen, you can lower the priority of the requests for the images that are not visible on the screen."}]},{"type":"codeListing","syntax":"swift","code":["final class ImageView: UIView {","    private var task: ImageTask?","","    override func willMove(toWindow newWindow: UIWindow?) {","        super.willMove(toWindow: newWindow)","","        task?.priority = newWindow == nil ? .low : .high","    }","}"]},{"anchor":"Create-URLs-Beforehand","level":2,"type":"heading","text":"Create URLs Beforehand"},{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"URL"},{"type":"text","text":" initializer is relatively expensive because it needs to parse the input string. Make sure to create the "},{"type":"codeVoice","code":"URL"},{"type":"text","text":" objects in the background."}]},{"anchor":"Auto-Retry","level":2,"type":"heading","text":"Auto Retry"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Enable "},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/urlsessionconfiguration\/2908812-waitsforconnectivity"},{"type":"text","text":" on "},{"type":"codeVoice","code":"URLSession"},{"type":"text","text":" to indicate that the session should wait for connectivity to become available instead of failing the request immediately in case of a network failure."}]},{"anchor":"Measure","level":2,"type":"heading","text":"Measure"},{"type":"paragraph","inlineContent":[{"type":"text","text":"If you want to see how the system behaves, how long each operation takes, and how many are performed in parallel, enable the "},{"type":"reference","isActive":true,"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePipeline\/Configuration-swift.struct\/isSignpostLoggingEnabled"},{"type":"text","text":" option and use the "},{"type":"codeVoice","code":"os_signpost"},{"type":"text","text":" Instrument. For more information see "},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/os\/logging"},{"type":"text","text":" and "},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/videos\/play\/wwdc2018\/405\/"},{"type":"text","text":"."}]}]}],"schemaVersion":{"major":0,"minor":3,"patch":0},"sections":[],"variants":[{"paths":["\/documentation\/nuke\/performance-guide"],"traits":[{"interfaceLanguage":"swift"}]},{"paths":["\/documentation\/nuke\/performance-guide"],"traits":[{"interfaceLanguage":"occ"}]}],"identifier":{"url":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/performance-guide","interfaceLanguage":"swift"},"abstract":[{"type":"text","text":"Learn how to improve image loading performance in your apps."}],"kind":"article","metadata":{"roleHeading":"Article","title":"Performance Guide","role":"article","modules":[{"name":"Nuke"}]},"hierarchy":{"paths":[["doc:\/\/com.github.kean.nuke\/documentation\/Nuke"]]},"seeAlsoSections":[{"title":"Performance","identifiers":["doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/prefetching","doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/combine","doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/caching","doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePrefetcher"],"generated":true}],"references":{"https://developer.apple.com/videos/play/wwdc2018/219":{"title":"Image and Graphics Best Practices","titleInlineContent":[{"type":"text","text":"Image and Graphics Best Practices"}],"type":"link","identifier":"https:\/\/developer.apple.com\/videos\/play\/wwdc2018\/219","url":"https:\/\/developer.apple.com\/videos\/play\/wwdc2018\/219"},"doc://com.github.kean.nuke/documentation/Nuke/DataCaching":{"role":"symbol","title":"DataCaching","fragments":[{"kind":"keyword","text":"protocol"},{"kind":"text","text":" "},{"kind":"identifier","text":"DataCaching"}],"abstract":[{"type":"text","text":"Data cache."}],"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/DataCaching","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"DataCaching"}],"url":"\/documentation\/nuke\/datacaching"},"https://developer.apple.com/documentation/foundation/urlsessionconfiguration/2908812-waitsforconnectivity":{"title":"waitsForConnectivity","titleInlineContent":[{"type":"codeVoice","code":"waitsForConnectivity"}],"type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/urlsessionconfiguration\/2908812-waitsforconnectivity","url":"https:\/\/developer.apple.com\/documentation\/foundation\/urlsessionconfiguration\/2908812-waitsforconnectivity"},"doc://com.github.kean.nuke/documentation/Nuke/ImagePipeline/Configuration-swift.struct/isSignpostLoggingEnabled":{"role":"symbol","title":"isSignpostLoggingEnabled","fragments":[{"kind":"keyword","text":"static"},{"kind":"text","text":" "},{"kind":"keyword","text":"var"},{"kind":"text","text":" "},{"kind":"identifier","text":"isSignpostLoggingEnabled"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"Bool","preciseIdentifier":"s:Sb"}],"abstract":[{"type":"codeVoice","code":"false"},{"type":"text","text":" by default. If "},{"type":"codeVoice","code":"true"},{"type":"text","text":", enables "},{"type":"codeVoice","code":"os_signpost"},{"type":"text","text":" logging for"},{"type":"text","text":" "},{"type":"text","text":"measuring performance. You can visually see all the performance"},{"type":"text","text":" "},{"type":"text","text":"metrics in "},{"type":"codeVoice","code":"os_signpost"},{"type":"text","text":" Instrument. For more information see"},{"type":"text","text":" "},{"type":"text","text":"https:\/\/developer.apple.com\/documentation\/os\/logging and"},{"type":"text","text":" "},{"type":"text","text":"https:\/\/developer.apple.com\/videos\/play\/wwdc2018\/405\/."}],"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePipeline\/Configuration-swift.struct\/isSignpostLoggingEnabled","kind":"symbol","type":"topic","url":"\/documentation\/nuke\/imagepipeline\/configuration-swift.struct\/issignpostloggingenabled"},"doc://com.github.kean.nuke/documentation/Nuke/prefetching":{"role":"article","title":"Prefetching","abstract":[{"type":"text","text":"Learn how to prefetch images to improve user experience."}],"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/prefetching","kind":"article","type":"topic","url":"\/documentation\/nuke\/prefetching"},"doc://com.github.kean.nuke/documentation/Nuke/ImagePipeline/DataCachePolicy/storeOriginalData":{"role":"symbol","title":"ImagePipeline.DataCachePolicy.storeOriginalData","fragments":[{"kind":"keyword","text":"case"},{"kind":"text","text":" "},{"kind":"identifier","text":"storeOriginalData"}],"abstract":[{"type":"text","text":"For all requests, only store the original image data, unless"},{"type":"text","text":" "},{"type":"text","text":"the resource is local (file:\/\/ or data:\/\/ scheme is used)."}],"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePipeline\/DataCachePolicy\/storeOriginalData","kind":"symbol","type":"topic","url":"\/documentation\/nuke\/imagepipeline\/datacachepolicy\/storeoriginaldata"},"doc://com.github.kean.nuke/documentation/Nuke/combine":{"role":"article","title":"Combine","abstract":[{"type":"text","text":"Learn how to use Combine publishers to improve image loading performance in your apps."}],"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/combine","kind":"article","type":"topic","url":"\/documentation\/nuke\/combine"},"doc://com.github.kean.nuke/documentation/Nuke/ImageEncoders/Default/isHEIFPreferred":{"role":"symbol","title":"isHEIFPreferred","fragments":[{"kind":"keyword","text":"var"},{"kind":"text","text":" "},{"kind":"identifier","text":"isHEIFPreferred"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"Bool","preciseIdentifier":"s:Sb"}],"abstract":[{"type":"text","text":"Set to "},{"type":"codeVoice","code":"true"},{"type":"text","text":" to switch to HEIF when it is available on the current hardware."},{"type":"text","text":" "},{"type":"codeVoice","code":"false"},{"type":"text","text":" by default."}],"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImageEncoders\/Default\/isHEIFPreferred","kind":"symbol","type":"topic","url":"\/documentation\/nuke\/imageencoders\/default\/isheifpreferred"},"doc://com.github.kean.nuke/documentation/Nuke/ImagePrefetcher":{"role":"symbol","title":"ImagePrefetcher","fragments":[{"kind":"keyword","text":"class"},{"kind":"text","text":" "},{"kind":"identifier","text":"ImagePrefetcher"}],"abstract":[{"type":"text","text":"Prefetches and caches images to eliminate delays when requesting the same"},{"type":"text","text":" "},{"type":"text","text":"images later."}],"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePrefetcher","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"ImagePrefetcher"}],"url":"\/documentation\/nuke\/imageprefetcher"},"https://kean.blog/post/resumable-downloads":{"title":"“Resumable Downloads”","titleInlineContent":[{"type":"text","text":"“Resumable Downloads”"}],"type":"link","identifier":"https:\/\/kean.blog\/post\/resumable-downloads","url":"https:\/\/kean.blog\/post\/resumable-downloads"},"doc://com.github.kean.nuke/documentation/Nuke/caching":{"role":"collectionGroup","title":"Caching","abstract":[{"type":"text","text":"Learn about cache layers in Nuke and how to configure them."}],"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/caching","kind":"article","type":"topic","url":"\/documentation\/nuke\/caching"},"https://en.wikipedia.org/wiki/Prefetching":{"title":"prefetching","titleInlineContent":[{"type":"text","text":"prefetching"}],"type":"link","identifier":"https:\/\/en.wikipedia.org\/wiki\/Prefetching","url":"https:\/\/en.wikipedia.org\/wiki\/Prefetching"},"doc://com.github.kean.nuke/documentation/Nuke/ImagePipeline/DataCachePolicy/storeEncodedImages":{"role":"symbol","title":"ImagePipeline.DataCachePolicy.storeEncodedImages","fragments":[{"kind":"keyword","text":"case"},{"kind":"text","text":" "},{"kind":"identifier","text":"storeEncodedImages"}],"abstract":[{"type":"text","text":"For all requests, encode and store decoded images after all"},{"type":"text","text":" "},{"type":"text","text":"processors are applied."}],"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePipeline\/DataCachePolicy\/storeEncodedImages","kind":"symbol","type":"topic","url":"\/documentation\/nuke\/imagepipeline\/datacachepolicy\/storeencodedimages"},"doc://com.github.kean.nuke/documentation/Nuke/ImagePipeline/DataCachePolicy/automatic":{"role":"symbol","title":"ImagePipeline.DataCachePolicy.automatic","fragments":[{"kind":"keyword","text":"case"},{"kind":"text","text":" "},{"kind":"identifier","text":"automatic"}],"abstract":[{"type":"text","text":"For requests with processors, encode and store processed images."},{"type":"text","text":" "},{"type":"text","text":"For requests with no processors, store original image data, unless"},{"type":"text","text":" "},{"type":"text","text":"the resource is local (file:\/\/ or data:\/\/ scheme is used)."}],"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePipeline\/DataCachePolicy\/automatic","kind":"symbol","type":"topic","url":"\/documentation\/nuke\/imagepipeline\/datacachepolicy\/automatic"},"doc://com.github.kean.nuke/documentation/Nuke/ImagePipeline/Configuration-swift.struct/dataCachePolicy-swift.property":{"role":"symbol","title":"dataCachePolicy","fragments":[{"kind":"keyword","text":"var"},{"kind":"text","text":" "},{"kind":"identifier","text":"dataCachePolicy"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"ImagePipeline","preciseIdentifier":"s:4Nuke13ImagePipelineC"},{"kind":"text","text":"."},{"kind":"typeIdentifier","text":"DataCachePolicy","preciseIdentifier":"s:4Nuke13ImagePipelineC15DataCachePolicyO"}],"abstract":[{"type":"text","text":"If you use an aggressive disk cache "},{"type":"reference","isActive":true,"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/DataCaching"},{"type":"text","text":", you can specify"},{"type":"text","text":" "},{"type":"text","text":"a cache policy with multiple available options and"},{"type":"text","text":" "},{"type":"reference","isActive":true,"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePipeline\/DataCachePolicy\/storeOriginalData"},{"type":"text","text":" used by default."}],"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImagePipeline\/Configuration-swift.struct\/dataCachePolicy-swift.property","kind":"symbol","type":"topic","url":"\/documentation\/nuke\/imagepipeline\/configuration-swift.struct\/datacachepolicy-swift.property"},"https://developer.apple.com/documentation/os/logging":{"title":"Apple Documentation: Logging","titleInlineContent":[{"type":"text","text":"Apple Documentation: Logging"}],"type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/os\/logging","url":"https:\/\/developer.apple.com\/documentation\/os\/logging"},"doc://com.github.kean.nuke/documentation/Nuke/ImageEncoders/ImageIO":{"role":"symbol","title":"ImageEncoders.ImageIO","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"ImageIO"}],"abstract":[{"type":"text","text":"An Image I\/O based encoder."}],"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/ImageEncoders\/ImageIO","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"ImageIO"}],"url":"\/documentation\/nuke\/imageencoders\/imageio"},"https://developer.mozilla.org/en-US/docs/Web/HTTP/Range_requests":{"title":"HTTP Range Requests","titleInlineContent":[{"type":"text","text":"HTTP Range Requests"}],"type":"link","identifier":"https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/HTTP\/Range_requests","url":"https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/HTTP\/Range_requests"},"doc://com.github.kean.nuke/documentation/Nuke":{"role":"collection","title":"Nuke","abstract":[{"type":"text","text":"A powerful image loading system for Apple platforms."}],"identifier":"doc:\/\/com.github.kean.nuke\/documentation\/Nuke","kind":"symbol","type":"topic","url":"\/documentation\/nuke"},"https://developer.apple.com/videos/play/wwdc2018/405/":{"title":"WWDC 2018: Measuring Performance Using Logging","titleInlineContent":[{"type":"text","text":"WWDC 2018: Measuring Performance Using Logging"}],"type":"link","identifier":"https:\/\/developer.apple.com\/videos\/play\/wwdc2018\/405\/","url":"https:\/\/developer.apple.com\/videos\/play\/wwdc2018\/405\/"}},"variantOverrides":[{"patch":[{"op":"replace","path":"\/identifier\/interfaceLanguage","value":"occ"},{"op":"add","path":"\/topicSections","value":null},{"op":"replace","path":"\/seeAlsoSections","value":[{"title":"Performance","identifiers":["doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/prefetching","doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/combine","doc:\/\/com.github.kean.nuke\/documentation\/Nuke\/caching"],"generated":true}]}],"traits":[{"interfaceLanguage":"occ"}]}]}